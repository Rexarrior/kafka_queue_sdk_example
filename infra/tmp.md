# QUERY PLAN
0 "Limit  (cost=3051.01..3051.01 rows=1 width=185)"
1 "  ->  Sort  (cost=3051.01..3051.01 rows=1 width=185)"
2 "        Sort Key: match_rules_retail_menu_discounts.__revision"
3 "        ->  Nested Loop  (cost=3037.04..3051.00 rows=1 width=185)"
4 "              Join Filter: (match_rules_retail_menu_discounts.application = application.entity_id)"
5 "              ->  Nested Loop  (cost=3037.04..3049.88 rows=1 width=185)"
6 "                    Join Filter: (match_rules_retail_menu_discounts.plus_available_option = plus_available_option.entity_id)"
7 "                    ->  Nested Loop  (cost=3037.04..3048.82 rows=1 width=185)"
8 "                          Join Filter: (match_rules_retail_menu_discounts.distance_to_restaurant = distance_to_restaurant.entity_id)"
9 "                          ->  Nested Loop  (cost=3037.04..3047.60 rows=1 width=185)"
10 "                                Join Filter: (match_rules_retail_menu_discounts.retail_application_time_from_last_order = retail_application_time_from_last_order.entity_id)"
11 "                                ->  Nested Loop  (cost=3037.04..3046.11 rows=1 width=185)"
12 "                                      Join Filter: (match_rules_retail_menu_discounts.restaurant_application_time_from_last_order = restaurant_application_time_from_last_order.entity_id)"
13 "                                      ->  Nested Loop  (cost=3037.04..3044.82 rows=1 width=185)"
14 "                                            Join Filter: (match_rules_retail_menu_discounts.retail_application_orders_count = retail_application_orders_count.entity_id)"
15 "                                            ->  Hash Join  (cost=3037.04..3043.36 rows=1 width=185)"
16 "                                                  Hash Cond: ((country.entity_id = match_rules_retail_menu_discounts.country) AND (region.entity_id = match_rules_retail_menu_discounts.region) AND (experiment.entity_id = match_rules_retail_menu_discounts.experiment) AND (has_yaplus.entity_id = match_rules_retail_menu_discounts.has_yaplus))"
17 "                                                  ->  Nested Loop  (cost=0.55..6.84 rows=1 width=32)"
18 "                                                        ->  Nested Loop  (cost=0.55..5.79 rows=1 width=24)"
19 "                                                              ->  Nested Loop  (cost=0.28..3.49 rows=1 width=16)"
20 "                                                                    ->  Seq Scan on country  (cost=0.00..1.19 rows=1 width=8)"
21 "                                                                          Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
22 "                                                                    ->  Index Scan using region_entity_type_idx on region  (cost=0.28..2.29 rows=1 width=8)"
23 "                                                                          Index Cond: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
24 "                                                              ->  Index Scan using eats_discounts_experiment__entity_type_idx on experiment  (cost=0.28..2.29 rows=1 width=8)"
25 "                                                                    Index Cond: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
26 "                                                        ->  Seq Scan on has_yaplus  (cost=0.00..1.04 rows=1 width=8)"
27 "                                                              Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
28 "                                                  ->  Hash  (cost=3036.47..3036.47 rows=1 width=185)"
29 "                                                        ->  Nested Loop  (cost=2.43..3036.47 rows=1 width=185)"
30 "                                                              Join Filter: (match_rules_retail_menu_discounts.restaurant_application_orders_count = restaurant_application_orders_count.entity_id)"
31 "                                                              ->  Nested Loop  (cost=2.43..3035.15 rows=1 width=185)"
32 "                                                                    Join Filter: (match_rules_retail_menu_discounts.platform = platform.entity_id)"
33 "                                                                    ->  Nested Loop  (cost=2.43..3034.05 rows=1 width=185)"
34 "                                                                          Join Filter: (match_rules_retail_menu_discounts.place_tag = place_tag.entity_id)"
35 "                                                                          ->  Seq Scan on place_tag  (cost=0.00..9.38 rows=1 width=8)"
36 "                                                                                Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
37 "                                                                          ->  Nested Loop  (cost=2.43..3024.66 rows=1 width=185)"
38 "                                                                                Join Filter: (match_rules_retail_menu_discounts.class = class.entity_id)"
39 "                                                                                ->  Nested Loop  (cost=2.43..3023.64 rows=1 width=185)"
40 "                                                                                      ->  Nested Loop  (cost=2.15..3023.31 rows=1 width=185)"
41 "                                                                                            ->  Nested Loop  (cost=1.72..3022.84 rows=1 width=185)"
42 "                                                                                                  ->  Nested Loop  (cost=1.29..3022.39 rows=1 width=185)"
43 "                                                                                                        ->  Nested Loop  (cost=0.86..3021.94 rows=1 width=185)"
44 "                                                                                                              Join Filter: (match_rules_retail_menu_discounts.tag = tag.entity_id)"
45 "                                                                                                              ->  Seq Scan on tag  (cost=0.00..15.59 rows=1 width=8)"
46 "                                                                                                                    Filter: (entity_value = 'vkusvill_loyalty_program'::text)"
47 "                                                                                                              ->  Nested Loop  (cost=0.86..3003.44 rows=233 width=185)"
48 "                                                                                                                    ->  Index Scan using eats_discounts_place__entity_type_idx on place  (cost=0.42..2.44 rows=1 width=8)"
49 "                                                                                                                          Index Cond: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
50 "                                                                                                                    ->  Index Scan using match_rules_retail_menu_discounts_place_idx on match_rules_retail_menu_discounts  (cost=0.44..2971.24 rows=2976 width=185)"
51 "                                                                                                                          Index Cond: (place = place.entity_id)"
52 "                                                                                                                          Filter: (((NOT empty_discount) OR (empty_discount IS NULL)) AND (__revision > 0))"
53 "                                                                                                        ->  Index Only Scan using match_data_pkey on match_data  (cost=0.43..0.45 rows=1 width=8)"
54 "                                                                                                              Index Cond: (data_id = match_rules_retail_menu_discounts.__data_id)"
55 "                                                                                                  ->  Index Scan using active_period_pkey on active_period  (cost=0.43..0.45 rows=1 width=8)"
56 "                                                                                                        Index Cond: (entity_id = match_rules_retail_menu_discounts.active_period)"
57 "                                                                                                        Filter: (is_start_utc AND is_end_utc AND (entity_value && '[\"2024-12-26 09:50:32+03\",\"2024-12-27 08:59:59+03\")'::tstzrange))"
58 "                                                                                            ->  Index Scan using product_pkey on product  (cost=0.43..0.45 rows=1 width=8)"
59 "                                                                                                  Index Cond: (entity_id = match_rules_retail_menu_discounts.product)"
60 "                                                                                                  Filter: (entity_value = '69fa67e2-c1a0-4fbe-a207-90517025da50'::text)"
61 "                                                                                      ->  Index Scan using brand_pkey on brand  (cost=0.29..0.31 rows=1 width=8)"
62 "                                                                                            Index Cond: (entity_id = match_rules_retail_menu_discounts.brand)"
63 "                                                                                            Filter: (entity_value = 174633)"
64 "                                                                                ->  Seq Scan on class  (cost=0.00..1.01 rows=1 width=8)"
65 "                                                                                      Filter: (entity_value = 'default'::text)"
66 "                                                                    ->  Seq Scan on platform  (cost=0.00..1.09 rows=1 width=8)"
67 "                                                                          Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
68 "                                                              ->  Seq Scan on restaurant_application_orders_count  (cost=0.00..1.31 rows=1 width=8)"
69 "                                                                    Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
70 "                                            ->  Seq Scan on retail_application_orders_count  (cost=0.00..1.45 rows=1 width=8)"
71 "                                                  Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
72 "                                      ->  Seq Scan on restaurant_application_time_from_last_order  (cost=0.00..1.27 rows=1 width=8)"
73 "                                            Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
74 "                                ->  Seq Scan on retail_application_time_from_last_order  (cost=0.00..1.48 rows=1 width=8)"
75 "                                      Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
76 "                          ->  Seq Scan on distance_to_restaurant  (cost=0.00..1.21 rows=1 width=8)"
77 "                                Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
78 "                    ->  Seq Scan on plus_available_option  (cost=0.00..1.05 rows=1 width=8)"
79 "                          Filter: (entity_type = 'Other'::match_rules_common.entity_type_any_other_t)"
80 "              ->  Seq Scan on application  (cost=0.00..1.09 rows=2 width=8)"
81 "                    Filter: ((entity_value = 'delivery-club'::text) OR (entity_value = 'yandex-eda'::text))"